// Расширенный header
$('.actionblock__icon_burger').click(function(e){
	e.preventDefault();
	$(this).toggleClass('active');
	$('.header').addClass('invisible');
	setTimeout(function(){
		$('.header').toggleClass('active');
		$('.actions').toggleClass('fullheader');
	}, 250)
	setTimeout(function(){
		$('.header').removeClass('invisible');
	}, 500)
})

// Меню профиля ЛК
$('.actionblock__username').click(function(e){
	e.preventDefault();
	$('.actionblock__account').toggleClass('active');
})

// Уведомления в ЛК (демо)
$('.actionblock__icon_notification').click(function(e){
	e.preventDefault();
	$(this).toggleClass('active');
})

// Поиск
$('.searchblock__icon_search, .actionblock__icon_search').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	$('.actionblock__icon_search').toggleClass('active');
	$('.actionblock').toggleClass('noshadow');
	$('.searchblock').removeClass('active');
	$('.searchblock__searchfield').toggleClass('active');
	$('.overlay').toggleClass('active');
})
$('.searchblock__searchfield').click(function(e){
	e.stopPropagation();
})
$('html').click(function(){
	$('.actionblock__icon_search').removeClass('active');
	$('.actionblock').removeClass('noshadow');
	$('.searchblock__searchfield').removeClass('active');
})

// Фильтр при скролле
$('.actionblock__icon_filter').click(function(e){
	e.preventDefault();
	$(this).toggleClass('active');
	$('.searchblock').toggleClass('active');
})


// Изменение блока действий при скролле
$(window).scroll(function(){
    var scroll = $(this).scrollTop();
	var headerheight = $('.header').outerHeight();
	var searchheight = $('.searchblock').outerHeight();
    if ( scroll >= 60 ) {
		$(".header").addClass("sticky");
		$(".actions").addClass("sticky");
    } else {
		$(".header").removeClass("sticky");
		$(".actions").removeClass("sticky");
	}
	if ( scroll >= 60+searchheight ) {
        $(".actions").addClass("active");
    } else {
		$(".actions").removeClass("active");
	}
	if ( scroll <= 204 ) {
		$(".header").removeClass("active");
		$(".actions").removeClass("fullheader");
		$(".actions_detail").removeClass("full");
		$('.actionblock__icon_burger').removeClass('active');
	} else {
		$(".actions_detail").addClass("full");
	}
});


// Выпадающий список в фильтре
$('.searchblock__option a').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	$(this).parents('.searchblock__menu').siblings().removeClass('active');
	$(this).parents('.searchblock__menu').toggleClass('active');
	if ( $(this).parent().hasClass('searchblock__option_categories') ) {
		$('.searchblock__categories').toggleClass('active');
		$('.overlay').toggleClass('active');
	} else {
		$('.searchblock__categories').removeClass('active');
		$('.overlay').removeClass('active');
	}
})
$('.searchblock__menu_magazine .searchblock__submenu a, .searchblock__menu_author .searchblock__submenu a').click(function(e){
    $(this).closest(".searchblock__menu").find(".searchblock__input").val( $(this).data("val") );
    $("#criteria").submit();

	return false;
})
$('html').click(function(){
	$('.searchblock__menu_date').removeClass('active');
})
$('.overlay').click(function(){
	$(this).removeClass('active');
	$('.searchblock__categories').removeClass('active');
	$('.searchblock__menu_categories').removeClass('active');
})

function selectSortFilter(selector){
    var selected_id = $('.' + selector).find('.searchblock__input').val();
    var selected_el = false;

    if(selected_id > 0){
        $('.' + selector).find('.searchblock__addmenu li a').each(function(){
            var id = $(this).data('id');
            if(id == selected_id){
                selected_el = this;
            }
        });

        if(selected_el){
            var typeval = $(selected_el).parents('[data-type]').data('type');
            var val = $(selected_el).data('value');

            $('.' + selector).find('[data-default]').text(typeval);	$('.' + selector).find('.searchblock__filterarrow').show();
            if (val == 'up') {
                $('.' + selector).find('.searchblock__filterarrow').addClass('up');
            } else {
                $('.' + selector).find('.searchblock__filterarrow').removeClass('up');
            }
            $('.' + selector).removeClass("active");

            if(selector == 'searchblock__menu_select'){
                $('.searchblock__leftside').addClass('active');
				$('.searchblock__icon_plus').hide();
            }
        }
    }
}

$(document).ready(function() {
    selectSortFilter('searchblock__menu_date');
    selectSortFilter('searchblock__menu_select');

    $('.favourite_user').on('click', function(){
        var pid = parseInt($(this).attr('href').replace('#', ''));
        var lnk = $(this);

        jQuery.ajax({
            url: "/blog/updateAuhtorFavourite",
            type: "get",
            data: {
                id: pid,
            },
            success: function(data) {
                if (data != '1' && data != '0')
                    return;
                favourite = data == '1';
                if (favourite) {
                    lnk.addClass('active');
                    $('.favourite_user').html("- Отписаться");
                } else {
                    lnk.removeClass('active');
                    $('.favourite_user').html("+ Подписаться");
                }

            }
        });

        return false;
    });

    //Guest subscribe popup
    $('.subscribe__form .subscribe__button').click(function (){
        var guest_email = $('.subscribe__form .subscribe__field input').val();

        if(guest_email != ''){
            $.ajax({
                url: "/site/guestSubscribe",
                type: "get",
                data: {
                    email: guest_email,
                },
                success: function(data) {

                    if($('.subscribe__form .subscribe__msg').length == 0){
                        $('.subscribe__form .subscribe__field').prepend('<div class="subscribe__msg"></div>');
                    }

                    if(data == 'successfully_added' || data == 'already_added'){
                        $('.subscribe__form .subscribe__msg').html('Спасибо! Вы подписаны.').removeClass('error');
                    }else if(data == 'email_not_correct'){
                        $('.subscribe__form .subscribe__msg').html('Ошибка! Не верный E-mail адрес.').addClass('error');
                    }
                }
            });
        }

        return false;
    });

	//Blog spoiler link click
	$('.spoiler_lnk').click(function() {
		if($(this).hasClass('active')){
			$(this).removeClass('active').find('span').html('↓');
			$(this).next().hide('fast');
		}else{
			$(this).addClass('active').find('span').html('↑');
			$(this).next().show('fast');

			$(window).scroll();
		}

		return false;
	});

	//Lightbox
	$("a[rel^='lightbox']").slimbox({
		counterText: "Изображение {x} из {y}",
	}, null, function(el) {

		if(el.title.indexOf("slimboxOpenOriginal") === -1)
		el.title = "<a href='" + el.href + "' target='_blank' class='slimboxOpenOriginal'></a>"+el.title;

		return true;
	});


	/*********************************************/
	// scroll up
	var bottom_position = 0;
	var flag_bottom = false;
	var flag_animate = false;
 	var win_width = 0;
	var in_top_hidden = false;

 	$(window).resize(function() {
 		win_width = $(window).width();

 		if (win_width < 320) {
    		if (!in_top_hidden) {
	    		$('.in_top').hide();
	    		in_top_hidden = true;
    		}
    	} else {
    		if (in_top_hidden) {
    			$('.in_top').show();
    			in_top_hidden = false;
    		}
    	}
 	});

 	$(window).resize();

	$('.in_top').click(function(e){
		e.preventDefault();
        flag_animate = true;
        if(flag_bottom){
            $("body,html").animate({"scrollTop":bottom_position}, 300, function(){
                flag_animate = false;
            });
            flag_bottom = false;
            $('.in_top .arrow').removeClass('down');
        }else{
            $("body,html").animate({"scrollTop":0}, 300, function(){
                flag_animate = false;
            });
            bottom_position = $(window).scrollTop();
            flag_bottom = true;
            $('.in_top .arrow').addClass('down');
        }
    });

    $(window).scroll(function(event){

    	if (in_top_hidden)
    		return;

        var countScroll = $(window).scrollTop();
        var reset_top = 260;

		if(typeof $('.actionblock').offset() !== 'undefined')
        var header_height = $('.actionblock').offset().top;

    	var top = (header_height - countScroll);
    	if (top < 0)
    		top = 0;
    	$('.in_top').css('top', top + 'px');

        if (countScroll >= reset_top && !flag_animate){
            if(flag_bottom){
                flag_bottom = false;
                $('.in_top').hide();
            } else {
            	if (countScroll >= header_height) {
            		$('.in_top').show();
                	$('.in_top .arrow').removeClass('down');
                	bottom_position = 0;
            	}
            }
        }else{
            if(!flag_bottom){
                $('.in_top').hide();
                $('.in_top .arrow').removeClass('down');
                flag_bottom = false;
                bottom_position = 0;
            }
        }
    });
	/*********************************************/
	if($(".detail__textblock").length){

		/* ============== */
		/* Link to copied text  */
		/* ============== */
		$(".detail__textblock").addtocopy({htmlcopytxt: '<br>Читать дальше: <a href="'+window.location.href+'">'+window.location.href+'</a>'});

		$(".detail__textblock img").lazyload({
			 effect : "fadeIn",
		});

	}
});

// Выбор параметра фильтра
$('.searchblock__menu [data-value]').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	var typeval = $(this).parents('[data-type]').data('type');
	var val = $(this).data('value');
    var id = $(this).data('id');
	$(this).parents('.searchblock__menu').find('[data-default]').text(typeval);	$(this).parents('.searchblock__menu').find('.searchblock__filterarrow').show();
	if (val == 'up') {				$(this).parents('.searchblock__menu').find('.searchblock__filterarrow').addClass('up');
	} else {	$(this).parents('.searchblock__menu').find('.searchblock__filterarrow').removeClass('up');
	}
	$(this).parents('.searchblock__menu').removeClass("active");

    $(this).parents('.searchblock__menu').find('.searchblock__input').val(id);
    $('#criteria').submit();
})

$('.searchblock__menu [data-type]').click(function(e){
	e.preventDefault();
	var typeval = $(this).data('type');
	$(this).parents('.searchblock__menu').find('[data-default]').text(typeval);	$(this).parents('.searchblock__menu').find('.searchblock__filterarrow').show();
	$(this).parents('.searchblock__menu').removeClass("active");
})


// Добавить параметр фильтра
$('.searchblock__icon_plus').click(function(e){
	e.preventDefault();
	$('.searchblock__leftside').addClass('active');
	$(this).hide();
})

// Убрать параметр фильтра
$('.searchblock__icon_minus').click(function(e){
	e.preventDefault();
	$('.searchblock__leftside').removeClass('active');
	$('.searchblock__icon_plus').show();
})


// Лайк карточки товара
$('.reviews__like').click(function(){
	$(this).toggleClass('active');

    var pid = $(this).attr('pid');

    $.ajax({
        url: "/blog/updateFavourite",
        type: "get",
        data: {
            id: pid,
        },
        success: function(data) {
            //console.log(pid, data);
            if (data != '1' && data != '0')
                return;
        }
    });
});

// Прикрепление файлов в комментарии
$('.comments__formupload').click(function(e){
	e.preventDefault();
	$(this).addClass('active');
	$('.comments__uploads').show();
})

// Удаление файла из комментария
$('.comments__deleteupload').click(function(){
	$(this).parent().hide();
})

// Фильтр в комментариях
$('.comments__shownew span').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	$(this).parent().toggleClass('active');
	$(this).siblings('.comments__submenu').toggleClass('active')
})
$('.comments__submenu [data-type]').click(function(e){
	e.preventDefault();
	var typeval = $(this).data('type');
	$(this).parents('.comments__shownew').find('span').text(typeval);
	$(this).parents('.comments__shownew').removeClass("active");
	$(this).parents('.comments__submenu').removeClass("active");
})

$('html').click(function(){
	$('.comments__shownew').removeClass("active");
	$('.comments__submenu').removeClass("active");
})


// Включение кнопки "Отправить" в комментариях при наборе текста
$('.comments__formfield textarea').keyup(function(){
	$(this).parents('form').find('button').removeAttr('disabled');
})

// Дополнительные действия в комментариях
$('.comments__actionicon_link').click(function(e){
	e.preventDefault();
	if ( $(this).hasClass('active') ) {
		$('.comments__actionicons .active').removeClass('active');
	} else {
		$('.comments__actionicons .active').removeClass('active');
		$(this).addClass('active');
		$(this).siblings('.comments__link').addClass('active');
	}
})

$('.comments__actionicon_share').click(function(e){
	e.preventDefault();
	if ( $(this).hasClass('active') ) {
		$('.comments__actionicons .active').removeClass('active');
	} else {
		$('.comments__actionicons .active').removeClass('active');
		$(this).addClass('active');
		$(this).siblings('.comments__share').addClass('active');
	}
})

$('.comments__actionicon_more').click(function(e){
	e.preventDefault();
	if ( $(this).hasClass('active') ) {
		$('.comments__actionicons .active').removeClass('active');
	} else {
		$('.comments__actionicons .active').removeClass('active');
		$(this).addClass('active');
		$(this).siblings('.comments__addactions').addClass('active');
	}
})

// Добавить обзор в избранное
$('.share__icon_like').click(function(e){
	e.preventDefault();
	$(this).addClass('active');

    var self = $(this);

    var pid = self.attr('pid');
    var favourite = self.hasClass('active');

    jQuery.ajax({
        url: "/blog/updateFavourite",
        type: "get",
        data: {
            id: pid,
        },
        success: function(data) {
            if (data != '1' && data != '0')
                return;
            favourite = data == '1';
            if (favourite) {
                self.addClass('active');
            } else {
                self.removeClass('active');

            }

        }
    });
});

// Оценка обзора
function starRating(el) {
	var starindex = $(el).parent().index('.share__icon_star');
	starindex++;

	if ( starindex == 1 ) {
		$('.share__icon_star').removeClass('two three four five');
		$(el).parent().addClass('one');
		$(el).parent().prevAll('.share__icon_star').addClass('one');
		$('.share__myrating').removeClass('two three four five');
		$('.share__myrating').addClass('one');
	}

	if ( starindex == 2 ) {
		$('.share__icon_star').removeClass('one three four five');
		$(el).parent().addClass('two');
		$(el).parent().prevAll('.share__icon_star').addClass('two');
		$('.share__myrating').removeClass('one three four five');
		$('.share__myrating').addClass('two');
	}

	if ( starindex == 3 ) {
		$('.share__icon_star').removeClass('one two four five');
		$(el).parent().addClass('three');
		$(el).parent().prevAll('.share__icon_star').addClass('three');
		$('.share__myrating').removeClass('one two four five');
		$('.share__myrating').addClass('three');
	}

	if ( starindex == 4 ) {
		$('.share__icon_star').removeClass('one two three five');
		$(el).parent().addClass('four');
		$(el).parent().prevAll('.share__icon_star').addClass('four');
		$('.share__myrating').removeClass('one two three five');
		$('.share__myrating').addClass('four');
	}

	if ( starindex == 5 ) {
		$('.share__icon_star').removeClass('one two three four');
		$(el).parent().addClass('five');
		$(el).parent().prevAll('.share__icon_star').addClass('five');
		$('.share__myrating').removeClass('one two three four');
		$('.share__myrating').addClass('five');
	}
}

$('.share__icon_star span').hover(function(){
	starRating(this);
	$(this).addClass('hover');
	$(this).prev().addClass('hover');
	$(this).parent().addClass('hover');
	$(this).parent().prevAll('.share__icon_star').addClass('hover');
	$(this).parent().prevAll('.share__icon_star').find('span').addClass('hover');
	},
	function(){
	$(this).removeClass('hover');
	$(this).prev().removeClass('hover');
	$(this).parent().removeClass('hover');
	$(this).parent().prevAll('.share__icon_star').removeClass('hover');
	$(this).parent().prevAll('.share__icon_star').find('span').removeClass('hover');
})

$('.share__icon_star span').click(function(){
	starRating(this);
	$(this).addClass('active');
	$(this).prev().addClass('active');
	$(this).parent().addClass('active');
	$(this).parent().prevAll('.share__icon_star').addClass('active');
	$(this).parent().prevAll('.share__icon_star').find('span').addClass('active');
	$('.share__icon_star').addClass('noclick');
	var rating = $(this).data('rating');
	$('.share__myrating span').text(rating);
	$('.share__myrating').addClass('active');
	$('.thanks').addClass('active');

	setTimeout(function(){
		$('.thanks').removeClass('active');
	}, 3000);

    $.ajax({
        type: "POST",
        url: "/blog/updateRating?id="+$('#post-id').val()+"&action="+rating.toString().replace(",", "."),
        dataType: "json",
        success: function(data) {
            $('.share__count_rating').html(data.value + '<span class="share__smallinfotext">голосов: ' + data.count + '</span>');
        }
    });

	$('.loginform__heading_main').hide();
	$('.loginform__heading_vote').show();
})

// Закрытие выплывающей плашки после оценки
$('.thanks__ok').click(function(e){
	e.preventDefault();
	$('.thanks').removeClass('active');
})


function reformalShowByPageSyze(){
    if ( jQuery(window).width() < 1050){
        jQuery('#reformal_tab').hide();
    } else {
        jQuery('#reformal_tab').show();
    }
}


// AJAX форма
$(document).ready(function() {
    //Reformal hiding on window size change
    $(window).on('resize', function() {
        reformalShowByPageSyze();
    });
    reformalShowByPageSyze();
});

// Переключение вида карточек товаров
$('.searchblock__icon_view').click(function(e){
	e.preventDefault();
	$('.searchblock__icon_view.active').removeClass('active');
	$(this).addClass('active');
	$('.reviews__cards').addClass('invisible');
	var view = $(this).data('view');
	if ( view == 'stripes' ) {
        $.cookie('list_view', true, {
            expires: 999,
            path: '/',
        });

		setTimeout(function(){
			$('.reviews__cards').addClass('stripes');
		}, 250)
	} else {
        $.cookie('list_view', true, {
            expires: -1,
            path: '/',
        });

		setTimeout(function(){
			$('.reviews__cards').removeClass('stripes');
		}, 250)
	}
	setTimeout(function(){
		$('.reviews__cards').removeClass('invisible');
	}, 500)
})


// Статус автора обзора
$(document).ready(function(){
	$('.usercard__statusbar_talent path').attr('d', 'M 70,0 A69,69 0 1 1 29,125.5');
	$('.usercard__statusbar_master path').attr('d', 'M 70,0 A69,69 0 1 1 3,47');
	$('.usercard__statusbar_writer path').attr('d', 'M 70,0 A69,69 0 0 1 110,125.5');
	$('.usercard__statusbar_novice path').attr('d', 'M 70,0 A69,69 0 0 1 135,49');
});


// Панель действий на странице обзора
$('.detail__action_hide').click(function(e){
	e.preventDefault();
	$(this).parent().addClass('active');

    var pid = jQuery(this).attr('pid');
    jQuery.ajax({
        url: "/admin/blog/postSwitchActive",
        type: "get",
        data: {
            id: pid
        },
        success: function(data) {
        }
    });
});
$('.detail__action_allow').click(function(e){
	e.preventDefault();
	$(this).parent().removeClass('active');

    var pid = jQuery(this).attr('pid');
    jQuery.ajax({
        url: "/admin/blog/postSwitchActive",
        type: "get",
        data: {
            id: pid
        },
        success: function(data) {
        }
    });
});


// Выпадающие списки сортировки ТОП на странице обзора
$('.sorting-list__link').click(function(e){
	e.preventDefault();
	e.stopPropagation();
	$(this).parent().toggleClass('active');
});
$('html').click(function(){
	$('.sorting-list').removeClass('active');
});
$(".topauthors__sorting-list .sorting-list__submenu a").click(function(){
    $("#top_authors_filter_val").val($(this).data('value'));
    $("#top_authors_filter").submit();

    return false;
});
$(".comments__sorting-list .sorting-list__submenu a").click(function(){
    $("#top_comments_filter_val").val($(this).data('value'));
    $("#top_comments_filter").submit();

    return false;
});


// Навигация карточек на странице обзора
$(document).ready(function(){
	$('.cardnav').each(function(){
		var navcards = $(this).siblings('.js-navcards');
		var containerWidth = navcards.width();
		var cardsWidth = 0;
		navcards.children().each(function(){
			cardsWidth = cardsWidth + $(this).outerWidth(true);
		});
		if ( cardsWidth > containerWidth ) {
			$(this).addClass('right-arrow');
		}
	});
});

$('.cardnav__arrow').click(function(e){
	e.preventDefault();
	var navcards = $(this).parent().siblings('.js-navcards');
	var containerWidth = navcards.width();
	var cardsWidth = 0;
	navcards.children().each(function(){
		cardsWidth = cardsWidth + $(this).outerWidth(true);
	});
	var containerTranslation = parseInt(navcards.css('transform').split(',')[4]);
	containerTranslation = Math.abs(containerTranslation);
	var diffWidth = cardsWidth - containerWidth - containerTranslation;
	if ( $(this).hasClass('next') ) {
		if ( diffWidth < 0 ) {
			return false;
		} else if ( diffWidth >= 0 && diffWidth <= containerWidth ) {
			navcards.css('transform', 'translate3d(-'+(diffWidth+containerTranslation)+'px,0,0)');
			$(this).parent().removeClass('right-arrow');
			$(this).parent().addClass('left-arrow');
		} else {
			navcards.css('transform', 'translate3d(-'+(containerWidth+containerTranslation)+'px,0,0)');
			$(this).parent().addClass('left-arrow');
		}
	} else {
		if ( containerTranslation == 0 ) {
			return false;
		} else if ( containerTranslation > 0 && containerTranslation < containerWidth ) {
			navcards.css('transform', 'translate3d(0,0,0)');
			$(this).parent().removeClass('left-arrow');
			$(this).parent().addClass('right-arrow');
		} else {
			navcards.css('transform', 'translate3d(-'+(containerTranslation-containerWidth)+'px,0,0)');
			$(this).parent().addClass('right-arrow');
		}
	}
});



// Плавное появление блоков при скролле
window.sr = ScrollReveal();
var fooReveal = {delay: 100, origin:'top', distance: '40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
var fooReveal1 = {delay: 200, origin:'top', distance: '40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000};
sr.reveal('.reviews .reviews__card, .detail__header, .detail__reviewinfo, .detail__imageblock, .detail__linkblock, .share__block, .share__bottom, .subscribe__form, .topauthors__heading, .interesting__heading, .comments__heading, .comments__block, .comments__firsttext, .comments__loginblock', fooReveal);
sr.reveal('.detail__textblock > p', {viewFactor: 0.01, delay: 100, origin:'top', distance: '40px', easing: 'cubic-bezier(0.3, 0.5, 0.1, 1)', scale: 1, mobile: false, duration: 1000});
sr.reveal('.detail__authorinfo, .container_navcards, .comments__form, .comments__topcomments', fooReveal1);




// Фиксировать экран для самописных модальных окон
function fixscreen() {
  window.scroll = $(window).scrollTop();
  $("body").css('top', -scroll + 'px').toggleClass('noscroll');
}

function unfixscreen() {
  $("body").css('top', "0").toggleClass('noscroll');
  $(window).scrollTop(scroll);
}



// Показ прелоадера при отправке формы
$(document).on({
  ajaxStart: function() { $(".preloader").addClass("active");},
  ajaxStop: function() { $(".preloader").removeClass("active");}
});




// Плавно скрыть/показать блок
function hideblock(el) {
  setTimeout(function() {$(el).show();}, 700);
  setTimeout(function() {$(el).css("opacity", "1");}, 900);
}

function showblock(el) {
  setTimeout(function() {$(el).css("opacity", "0");}, 700);
  setTimeout(function() {$(el).show();}, 900);
}



// Ссылки навигации по странице (добавить класс nav к ссылке с #)
$("a.nav").click(function(event){
    event.preventDefault();
    $('html,body').animate({scrollTop:$(this.hash).offset().top}, 1200);
});




// Всплывающие окна
$(".fancybox").fancybox({
    fitToView   : false,
    autoSize    : true,
    openEffect  : 'fade',
    closeEffect : 'fade',
});



// Проверка формы на правильность введенных данных
$(".fake-button").click(function(){
    window.activeform = $(this).parents("form").attr("id");

    checkselects();
    checkinputs();
    checkandsubmit();
});

// 1. Проверка селектов
function checkselects() {
    if (select1val === false) { $('#'+activeform+' select[name="city"]').parent().addClass("error"); }
    if (select2val === false) { $('#'+activeform+' select[name="clienttype"]').parent().addClass("error"); }
    if (select3val === false) { $('#'+activeform+' select[name="orgform"]').parent().addClass("error"); }
}

// 2. Проверка текстовых input'ов
function checkinputs() {
    // Проверка обычных полей на заполненность
    checkempty();

    // Проверка поля email
    function isEmail(email) {
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }
    if ( isEmail($('#'+activeform+' input[name="email"]').val()) === false) {
        $('#'+activeform+' input[name="email"]').parent().addClass("error")
    } else {$('#'+activeform+' input[name="email"]').parent().removeClass("error")}
}

// 3. Проверка на ошибочные поля и отправка формы
function checkandsubmit() {
    window.formerrors = 0;
    $('#'+activeform).find("div.error").each(function(){
        formerrors += 1;
    });
    if (formerrors === 0) {
        $('#'+activeform).submit();
    }
}

// Скрипт проверки на пустое значение
function checkempty() {
    $('#'+activeform+' input[data-required]').each(function(){
        if (!$(this).val()) {
            $(this).parent().addClass("error")
        } else {$(this).parent().removeClass("error")}
    });
}

// Проверка номера телефона
function phonenumerlength() {
   if ( $('#'+activeform+' input[name="tel"]').val().match(/\d/g).length < 11) {
       $('#'+activeform+' input[name="tel"]').addClass("error")
   } else {$('#'+activeform+' input[name="tel"]').removeClass("error")}
}

// Убрать ошибку при изменении input'а
$("input").on("keyup change", function(){
   $(this).parent().removeClass("error");
});

// Только цифры в input'е
$('.onlynumber').change(function(e){
  if (/\D/g.test(this.value))
  {
    this.value = this.value.replace(/\D/g, '');
  }
});

// ################## //
// Только буквы в input'е
// ################## //
$('.letteronly').bind('keyup blur',function(){
    var node = $(this);
    node.val(node.val().replace(/\d/g,'') ); }
);








// Переход названия поля в активное состояние
$("input, textarea").focus(function(){
   window.nowform = $(this).closest("form").attr("id");
   $(this).prev().addClass('active');
});

$("input, textarea, select").on("blur change", function(){
    window.nowform = $(this).closest("form").attr("id");
   if ($(this).val() === "") {
       $(this).prev().removeClass('active');
   }
});



// Маска для поля ввода телефона
$(document).ready(function(){
   $("input[name='tel']").inputmask("+7 (999) 999-99-99");
});



// Кросс-браузерный Placeholder
function supports_input_placeholder() {var i = document.createElement('input'); return 'placeholder' in i;}

if (!supports_input_placeholder()) {
  var fields = document.getElementsByTagName('INPUT');
  for(var i=0; i < fields.length; i++) {
    if(fields[i].hasAttribute('placeholder')) {
      fields[i].defaultValue = fields[i].getAttribute('placeholder');
      fields[i].onfocus = function() { if(this.value == this.defaultValue) this.value = ''; }
      fields[i].onblur = function() { if(this.value == '') this.value = this.defaultValue; }
    }
  }
}

function yashareReplaceButs(){
    $('.button_social_vk').click(function (){
        $('.b-share-btn__vkontakte span').eq(0).click();
        yashareReplaceButsCounters();
        return false;
    });

    $('.button_social_fb').click(function (){
        $('.b-share-btn__facebook span').eq(0).click();
        yashareReplaceButsCounters();
        return false;
    });

    $('.button_social_twitter').click(function (){
        $('.b-share-btn__twitter span').eq(0).click();
        yashareReplaceButsCounters();
        return false;
    });

    $('.button_social_ok').click(function (){
        $('.b-share-btn__odnoklassniki span').eq(0).click();
        yashareReplaceButsCounters();
        return false;
    });

    $('.button_social_mailru').click(function (){
        $('.b-share-btn__moimir span').eq(0).click();
        yashareReplaceButsCounters();
        return false;
    });

    yashareReplaceButsCounters();
}
function yashareReplaceButsCounters(){
    $('.button_social_vk .button__number').html($('.b-share-btn__vkontakte span.b-share-counter').html());
    $('.button_social_fb .button__number').html($('.b-share-btn__facebook span.b-share-counter').html());
    $('.button_social_twitter .button__number').html($('.b-share-btn__twitter span.b-share-counter').html());
    $('.button_social_ok .button__number').html($('.b-share-btn__odnoklassniki span.b-share-counter').html());
    $('.button_social_mailru .button__number').html($('.b-share-btn__moimir span.b-share-counter').html());

    $('.button_social .button__number').each(function (){
        if($(this).html() == ''){
            $(this).html('0');
        }
    });
}
